<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>从PNG图像文件结构到隐写术 | 孤烟实验室</title><meta name="description" content="密码技术的一种"><meta name="keywords" content="-隐写术"><meta name="author" content="翟培基"><meta name="copyright" content="翟培基"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="https://zhaipeiji.github.io/2019/10/02/从PNG图像文件结构到隐写术/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="从PNG图像文件结构到隐写术"><meta name="twitter:description" content="密码技术的一种"><meta name="twitter:image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=437977044,3534490535&amp;fm=26&amp;gp=0.jpg"><meta property="og:type" content="article"><meta property="og:title" content="从PNG图像文件结构到隐写术"><meta property="og:url" content="https://zhaipeiji.github.io/2019/10/02/从PNG图像文件结构到隐写术/"><meta property="og:site_name" content="孤烟实验室"><meta property="og:description" content="密码技术的一种"><meta property="og:image" content="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=437977044,3534490535&amp;fm=26&amp;gp=0.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="JAVA中方法详解" href="https://zhaipeiji.github.io/2019/10/05/JAVA中方法详解/"><link rel="next" title="Blender学习笔记（一）" href="https://zhaipeiji.github.io/2019/10/01/Blender学习笔记（一）/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'false',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: '添加书签',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false
  
}</script></head><body><canvas class="fireworks"></canvas><div id="header"> <div id="page-header"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">孤烟实验室</a></span><i class="fa fa-bars fa-fw toggle-menu pull-right close" aria-hidden="true"></i><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 全部档案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right" id="search_button"></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lozad avatar_img" src="https://i.loli.net/2019/10/01/V9lAxE45beTWsyq.png" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">13</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">9</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">7</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 全部档案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div><script>document.body.addEventListener('touchstart', function(){ });</script></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#一．-PNG文件概述"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">一． PNG文件概述</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#二．-PNG文件结构说明"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">二． PNG文件结构说明</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#先明确几个概念："><span class="toc_mobile_items-number">2.0.1.</span> <span class="toc_mobile_items-text">先明确几个概念：</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#接下来，我们分类介绍各种数据块"><span class="toc_mobile_items-number">2.0.2.</span> <span class="toc_mobile_items-text">接下来，我们分类介绍各种数据块</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#1-四种关键数据块：（以下分析中只详细介绍每个数据块的数据部分）"><span class="toc_mobile_items-number">2.0.2.1.</span> <span class="toc_mobile_items-text">1. 四种关键数据块：（以下分析中只详细介绍每个数据块的数据部分）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#2-10种辅助数据块"><span class="toc_mobile_items-number">2.0.2.2.</span> <span class="toc_mobile_items-text">2.        10种辅助数据块</span></a></li></ol></li></ol></li></ol><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#三．-文件分析实例"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">三． 文件分析实例</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#四．-从PNG图像文件结构分析到拓展应用—压缩图片"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">四． 从PNG图像文件结构分析到拓展应用—压缩图片</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#五．-从PNG图像文件结构分析到拓展应用—隐写术"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">五． 从PNG图像文件结构分析到拓展应用—隐写术</span></a></li></div></div><div id="body-wrap"><div id="web_bg"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一．-PNG文件概述"><span class="toc-number">1.</span> <span class="toc-text">一． PNG文件概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二．-PNG文件结构说明"><span class="toc-number">2.</span> <span class="toc-text">二． PNG文件结构说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#先明确几个概念："><span class="toc-number">2.0.1.</span> <span class="toc-text">先明确几个概念：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#接下来，我们分类介绍各种数据块"><span class="toc-number">2.0.2.</span> <span class="toc-text">接下来，我们分类介绍各种数据块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-四种关键数据块：（以下分析中只详细介绍每个数据块的数据部分）"><span class="toc-number">2.0.2.1.</span> <span class="toc-text">1. 四种关键数据块：（以下分析中只详细介绍每个数据块的数据部分）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-10种辅助数据块"><span class="toc-number">2.0.2.2.</span> <span class="toc-text">2.        10种辅助数据块</span></a></li></ol></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#三．-文件分析实例"><span class="toc-number">3.</span> <span class="toc-text">三． 文件分析实例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四．-从PNG图像文件结构分析到拓展应用—压缩图片"><span class="toc-number">4.</span> <span class="toc-text">四． 从PNG图像文件结构分析到拓展应用—压缩图片</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#五．-从PNG图像文件结构分析到拓展应用—隐写术"><span class="toc-number">5.</span> <span class="toc-text">五． 从PNG图像文件结构分析到拓展应用—隐写术</span></a></li></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=437977044,3534490535&amp;fm=26&amp;gp=0.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">从PNG图像文件结构到隐写术</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-10-02<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-10-02</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/黑科技/">黑科技</a></span><div class="post-meta-wordcount"><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="一．-PNG文件概述"><a href="#一．-PNG文件概述" class="headerlink" title="一． PNG文件概述"></a>一． PNG文件概述</h1><p>PNG是一种图像文件存储格式，其目的是试图替代<a href="https://baike.so.com/doc/3302186.html" target="_blank" rel="noopener">GIF</a>和<a href="https://baike.so.com/doc/1747926.html" target="_blank" rel="noopener">TIFF</a>文件格式，同时增加一些GIF文件格式所不具备的特性。称可移植网络图形格式(Portable Network Graphic Format，PNG)，是一种<a href="https://baike.so.com/doc/630856-667651.html" target="_blank" rel="noopener">位图</a>文件(bitmap file)存储格式，读成”ping”。本文将详细分析PNG图片的编码</p>
<h1 id="二．-PNG文件结构说明"><a href="#二．-PNG文件结构说明" class="headerlink" title="二． PNG文件结构说明"></a>二． PNG文件结构说明</h1><h3 id="先明确几个概念："><a href="#先明确几个概念：" class="headerlink" title="先明确几个概念："></a>先明确几个概念：</h3><ul>
<li><p>PNG文件由8个字节的PNG文件署名和特定的数据块构成</p>
</li>
<li><p>PNG的数据块分为关键数据块和辅助数据块，关键数据块每个PNG文件都有，辅助数据块可选</p>
</li>
<li><p>每个数据块都由4个不同的部分组成：</p>
<p>A． 表示长度的域，表示该数据块中数据域的长度（四字节）</p>
<p>B． 数据块类型码，表示该数据块类型（四字节）</p>
<p>C． 数据块数据，存储指定数据</p>
<p>D．循环冗余检测</p>
</li>
<li><p>文件头署名域：最开头的8字节的PNG文件署名域用来识别该文件是不是PNG文件。该域的值是：89 50 4E 47 0D 0A 1A 0A</p>
</li>
<li><p>除了表示数据块开始的IHDR必须放在最前面， 表示PNG文件结束的IEND数据块放在最后面之外，其他数据块的存放顺序没有限制。</p>
</li>
<li><p>关于循环冗余检测（CRC）校验码</p>
<p>A  CRC即循环冗余校验码（Cyclic Redundancy Check）：是数据通信领域中最常用的一种查错校验码，其特征是信息字段和校验字段的长度可以任意选定。循环冗余检查（CRC）是一种数据传输检错功能，对数据进行多项式计算，并将得到的结果附在帧的后面，接收设备也执行类似的算法，以保证数据传输的正确性和完整性。</p>
<p>B.  CRC码可以直接通过HxD分析中的校验码进行计算（选中CRC-32即可），也可以通过在线计算器，如：<a href="http://www.ip33.com/crc.html" target="_blank" rel="noopener">点击进入</a></p>
<p>C.  感兴趣的同学可以看以下计算方法，不感兴趣可以直接跳过。</p>
<p>D.  计算方法如下</p>
<p>​    1)       确定CRC生成多项式，PNG的多项式为x^32+x^26+x^23+x^22+x^16+x^12+x^11+x^10+x^8+x^7+x^5+x^4+x^2+x+1</p>
<p>​    2)       按照多项式（多项式只列出二进制值为1的位）得到二进制1 0000 0100 1100 0001 0001 1101 1011 0111</p>
<p>​    3)       找到要校验的数据（PNG中是数据块类型码加上数据块数据）的二进制，在后面再加上4个0</p>
<p>​    4)       然后把要校验的数据以“模2除法”方式(就是异或，1-1=0，0-1=1，1-0=1，0-0=0，无进位，无借位。)除以多项式，得到的余数即CRC码</p>
</li>
</ul>
<h3 id="接下来，我们分类介绍各种数据块"><a href="#接下来，我们分类介绍各种数据块" class="headerlink" title="接下来，我们分类介绍各种数据块"></a>接下来，我们分类介绍各种数据块</h3><h4 id="1-四种关键数据块：（以下分析中只详细介绍每个数据块的数据部分）"><a href="#1-四种关键数据块：（以下分析中只详细介绍每个数据块的数据部分）" class="headerlink" title="1. 四种关键数据块：（以下分析中只详细介绍每个数据块的数据部分）"></a>1. 四种关键数据块：（以下分析中只详细介绍每个数据块的数据部分）</h4><p>   A．  文件头数据块（IHDR），由13字节组成，包含有PNG文件中存储的图像数据的基本信息，并要作为第一个数据块出现在PNG数据流中，而且一个PNG数据流中只能有一个文件头数据块。，</p>
<p>   ​    a)  前8个字节分别是图像的宽度和高度，单位像素</p>
<p>   ​    b)  第9字节是色深：</p>
<p>   ​            彩色图像的色深为：1，2，4或8</p>
<p>   ​            灰度图像的色深为：1，2，4，8或16</p>
<p>   ​            真彩色图像的色深为：8或16</p>
<p>   ​    c)  第10字节表示索引图像颜色类型：</p>
<p>   ​            0表示灰度图像, 色深1，2，4，8或16</p>
<p>   ​            2表示真彩色图像，色深8或16</p>
<p>   ​            3表示索引彩色图像，色深1，2，4或8</p>
<p>   ​            4表示带α通道数据的灰度图像，色深8或16</p>
<p>   ​            6表示带α通道数据的真彩色图像，色深8或16</p>
<p>   ​    d) 第11字节表示压缩方法（LZ77派生算法，暂时还没有搞懂）</p>
<p>   ​    e) 第12字节00表示滤波器方法   </p>
<p>   ​    f)  第13字节00表示非隔行扫描-0，或Adam1（由Adam M. Costello开发的7遍隔行扫描方法）-1</p>
<p>   B．   调色板数据块（PLTE），它包含有与索引彩色图像((indexed-color image))相关的彩色变换数据，它仅与索引彩色图像有关，而且要放在图像数据块(image data chunk)之前。真彩色的PNG数据流也可以有调色板数据块，目的是便于非真彩色显示程序用它来量化图像数据，从而显示该图像。</p>
<p>   调色板实际是一个彩色索引查找表，它的表项数目可以是1～256中的一个数，每个表项有3字节</p>
<p>   C．   图像数据块IDAT(image data chunk)：它存储实际的数据，在数据流中可包含多个连续顺序的图像数据块。</p>
<p>   D．  图像结束数据IEND(image trailer chunk)：它用来标记PNG文件或者数据流已经结束，并且必须要放在文件的尾部。</p>
<h4 id="2-10种辅助数据块"><a href="#2-10种辅助数据块" class="headerlink" title="2.        10种辅助数据块"></a>2.        10种辅助数据块</h4><p>​    A．  背景颜色数据块bKGD(background color)。</p>
<p>​    B．   基色和白色度数据块cHRM(primary chromaticities and white point)。所谓白色度是指当R＝G            ＝B＝最大值时在显示器上产生的白色度。</p>
<p>​    C．   图像γ数据块gAMA(image gamma)。</p>
<p>​    D．  图像直方图数据块hIST(image histogram)。</p>
<p>​    E．   物理像素尺寸数据块pHYs(physical pixel dimensions)。</p>
<p>​    F．   样本有效位数据块sBIT(significant bits)。</p>
<p>​    G．  文本信息数据块tEXt(textual data)。</p>
<p>​    H．  图像最后修改时间数据块tIME (image last-modification time)。</p>
<p>​    I．     图像透明数据块tRNS (transparency)。</p>
<p>​    J．    压缩文本数据块zTXt (compressed textual data)。</p>
<h1 id="三．-文件分析实例"><a href="#三．-文件分析实例" class="headerlink" title="三． 文件分析实例"></a>三． 文件分析实例</h1><ul>
<li>我们用自制的一张图片FirstTry.png进行分析，以下是这个文件的基本属性：</li>
</ul>
<p>​       分辨率：16*16</p>
<p>​       宽度：16像素</p>
<p>​       高度：16像素</p>
<p>​       位深度：1</p>
<p>​       大小：152字节</p>
<ul>
<li>使用HxD将文件打开，如图，我们逐一分析文件</li>
</ul>
<p><img alt="ACS.png" data-src="https://i.loli.net/2019/10/02/7W8h1gNDvu4CLQa.png" class="lozad"></p>
<ul>
<li>首先，从文件头开始前八个字节是PNG文件的标志89 50 4E 47 0D 0A 1A 0A，从右侧可以看到，50，4E，47的ASCII码是PNG。即PNG文件署名域，8字节的PNG文件署名域用来识别该文件是不是PNG文件。</li>
</ul>
<ul>
<li>接下来第一个数据块为文件头数据块IHDR“00 00 00 0D 49 48 44 52 00 00 00 10 00 00 00 10 01 03 00 00 00 25 3D 6D 22”，即从9字节到25字节。</li>
</ul>
<ol>
<li><p>9~12字节是00 00 00 0D是文件头的数据长度，转成10进制是13，表示除去IHDR的ASCII码部分（即后面4个字节“49 48 44 52”）和最后的CRC循环冗余检测部分（即该IHDR数据块最后4个字节“25 3D 6D 22“）剩下的部分长度为13个字节。</p>
</li>
<li><p>12~16字节是“IHDR“的ASCII码，是数据块类型标志</p>
</li>
<li><p>之17~24字节是图像的宽度00 00 00 10（宽）00 00 00 10（高），单位像素，说明该图片是16*16像素的</p>
</li>
<li><p>25字节是色深此时的“01“是指2的1次方</p>
</li>
<li><p>26字节“03“表示索引图像</p>
</li>
<li><p>27字节00表示用Deflate压缩编码压缩图像数据</p>
</li>
<li><p>28字节00表示为将来用更好的压缩方式压缩而预留    </p>
</li>
<li><p>29字节00表示非隔行扫描</p>
</li>
<li><p>30~33字节表示CRC值（上文已经说过，这里不再赘述）</p>
</li>
</ol>
<ul>
<li>第二个数据块为sRGB数据块“00 00 00 01 73 52 47 42 00 AE CE 1C E9”即从第34字节到46字节。</li>
</ul>
<ol>
<li><p>34字节到37字节“00 00 00 01“是数据长度</p>
</li>
<li><p>38字节到41字节“73 52 47 42”的ASCII码是sRGB</p>
</li>
<li><p>42字节是sRGB数据块的数据，由于在官网上无法查询到定义，暂时不明意义，该数据块是辅助数据块，若整体删除该数据块，图片不影响。</p>
</li>
<li><p>43字节到46字节是循环冗余检测</p>
</li>
</ol>
<ul>
<li>第三个数据块为gAMA校正信息数据块“00 00 00 04 67 41 4D 41 00 00 B1 8F 0B FC 61 05”，即从第47字节到62字节。</li>
</ul>
<ol>
<li><p>47字节到50字节“00 00 00 04”是数据长度</p>
</li>
<li><p>51字节到54字节“73 52 47 42”的ASCII码是gAMA</p>
</li>
<li><p>55字节到58字节“00 00 B1 8F”储存着gamma校正信息,删去后不影响。</p>
</li>
</ol>
<p>（这里涉及到gamma图像校正的知识，在这里不做讨论，详情可参考<a href="https://blog.csdn.net/linqianbi/article/details/78617615）" target="_blank" rel="noopener">https://blog.csdn.net/linqianbi/article/details/78617615）</a></p>
<ol start="4">
<li>59字节到62字节是循环冗余检测</li>
</ol>
<ul>
<li>第四个数据块为PLTE调色板数据块“00 00 00 06 50 4C 54 45 00 00 00 FF FF FF A5 D9 9F DD”，即63字节到80字节。</li>
</ul>
<ol>
<li><p>63字节到66字节“00 00 00 06”是数据长度 </p>
</li>
<li><p>67字节到70字节“50 4C 54 45”的ASCII码是“PLTE”</p>
</li>
<li><p>71字节到76字节是调色板的内容，调色板的颜色数不能超过色深（此图片为2）中规定的颜色数（图像色深为1的时候，调色板中的颜色数不可以超过2^1=2），否则，这将导致PNG图像不合法。“00 00 00”是第一个索引，”FF FF FF”是第二个索引。</p>
</li>
<li><p>77字节到80字节是循环冗余检测</p>
</li>
</ol>
<ul>
<li>第五个数据块为PHYs数据块“00 00 00 09 70 48 59 73 00 00 12 74 00 00 12 74 01 DE 66 1F 78”，即81字节到101字节。</li>
</ul>
<ol>
<li><p>81字节到84字节“00 00 00 09”是数据长度</p>
</li>
<li><p>85字节到89字节“70 48 59 73”的ASCII码是“PHYs”</p>
</li>
<li><p>90字节到93字节“00 00 12 74”表示x轴上每米像素的数量，即每米4724个像素</p>
</li>
<li><p>94字节到96字节“00 00 12 74”表示y轴上每米像素的数量，即每米4724个像素</p>
</li>
<li><p>97字节“01”将单位定义为米</p>
</li>
<li><p>98字节到101字节是循环冗余检测</p>
</li>
</ol>
<ul>
<li>第六个数据块为图像数据块IDAT(image data chunk)“00 00 00 1B 49 44 41 54 18 D3 63 F8 FF 1F 81 7E BF 47 E2 D6 83 11 4C FC 07 3F 88 F1 FF 3F 00 DE 8E 1D C2 83 25 11 80”：它存储实际的数据，在数据流中可包含多个连续顺序的图像数据块，存放着图像真正的数据信息</li>
</ul>
<ol>
<li><p>102字节到105字节“00 00 00 1B”是数据长度</p>
</li>
<li><p>106字节到109字节的ASCII码是“IDAT”</p>
</li>
<li><p>110字节到137字节是图像数据块，使用变种的7z压缩过</p>
</li>
<li><p>138字节到141字节是循环冗余检测</p>
</li>
</ol>
<ul>
<li>第七个数据块为图像结束数据块IEND，标志图片结束</li>
</ul>
<ol>
<li><p>141字节到144字节“00 00 00 00”是数据长度0</p>
</li>
<li><p>145字节到148字节“49 45 4E 44”的ASCII码是IEND</p>
</li>
<li><p>149字节到152字节“AE 42 60 82”是循环冗余检测</p>
</li>
</ol>
<ul>
<li>至此，该图片分析完毕</li>
</ul>
<h1 id="四．-从PNG图像文件结构分析到拓展应用—压缩图片"><a href="#四．-从PNG图像文件结构分析到拓展应用—压缩图片" class="headerlink" title="四． 从PNG图像文件结构分析到拓展应用—压缩图片"></a>四． 从PNG图像文件结构分析到拓展应用—压缩图片</h1><ul>
<li><p>在分析图片FirstTry.png时，发现了两个较为有意思的点，第一，删除某些辅助数据块，图片不影响（之所以说“某些”，是因为不确定有些情况下辅助数据块的真正作用可能会改变图片本身，如PHYs数据块不能删除）；第二，可以在文件中添加未定义的数据，图片查看器不会读取这些数据。</p>
</li>
<li><p>从第一点中，我们可以压缩图片大小，去掉不需要的数据块将图片FirstTry.png从152字节变为123字节</p>
</li>
</ul>
<h1 id="五．-从PNG图像文件结构分析到拓展应用—隐写术"><a href="#五．-从PNG图像文件结构分析到拓展应用—隐写术" class="headerlink" title="五． 从PNG图像文件结构分析到拓展应用—隐写术"></a>五． 从PNG图像文件结构分析到拓展应用—隐写术</h1><ul>
<li>我们发现，正常的PNG结尾都是图像结束数据块（IEND），图片查看器会忽视结束数据块之后的内容，所以我们可以把内容附加到图像结束数据块后面</li>
</ul>
<ol>
<li><p>如：在FirstTry.png的末尾加上一串数据：53 74 6F 70 21 48 65 72 65 53 70 79（Stop!HereSpy）</p>
</li>
<li><p>这样，传输图片时该数据便也被隐形传输了</p>
</li>
</ol>
<ul>
<li>第二种隐藏方法，图片本身内容是是要隐藏的数据，我们可以删除数据块使图片出错，加密数据本身。</li>
</ul>
<ol>
<li><p>如图片secret1.png,直接打开后显示格式错误，于是我们用HxD打开</p>
</li>
<li><p>发现IHDR数据块只留下了IH缺少DR，PHYs数据块的s缺少，最后没有结尾数据块，于是我们将缺少的部分补齐。</p>
<p>  DR的ASCII码：44 52</p>
<p>  s的ASCII码：73</p>
<p>  结尾数据块：00 00 00 00 49 45 4E 44 AE 42 60 82</p>
<p>  最后得到真正的图片</p>
</li>
</ol>
<p><img alt="secret.png" data-src="https://i.loli.net/2019/10/02/xKAfRqbJpEl1LBs.png" class="lozad">（但愿没有人用这个表白）</p>
<p>以上。<br>参考资料：《揭秘数据解密的关键技术》(作者：刘颖东)<br>        <a href="https://dev.gameres.com/Program/Visual/Other/PNGFormat.htm" target="_blank" rel="noopener">https://dev.gameres.com/Program/Visual/Other/PNGFormat.htm</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">翟培基</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zhaipeiji.github.io/2019/10/02/从PNG图像文件结构到隐写术/">https://zhaipeiji.github.io/2019/10/02/从PNG图像文件结构到隐写术/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zhaipeiji.github.io">孤烟实验室</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/隐写术/">-隐写术    </a></div><div class="post_share"><div class="social-share" data-image="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=437977044,3534490535&amp;fm=26&amp;gp=0.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" src="/img/wechat.png"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" src="/img/alipay.jpg"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2019/10/05/JAVA中方法详解/"><img class="prev_cover lozad" data-src="http://i-1.bbtiku.com/2017/7/17/807707d7-c8d6-4a1f-bce8-46c4a6d30c68.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>JAVA中方法详解</span></div></a></div><div class="next-post pull-right"><a href="/2019/10/01/Blender学习笔记（一）/"><img class="next_cover lozad" data-src="https://pic1.zhimg.com/v2-054e09e0cf742d61b1b52add0f268514_r.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Blender学习笔记（一）</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'Aq8HpC0xnFrSv6zbnnT9F5P8-gzGzoHsz',
  appKey:'RWXRM1HSOqjOQILpzoxaqRl4',
  placeholder:'Please leave your footprints',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'en',
  recordIP: true
});</script></div></div></div><footer style="background-image: url(https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=437977044,3534490535&amp;fm=26&amp;gp=0.jpg)"><div id="footer"><div class="copyright">&copy;2019 By 翟培基</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换">繁</a><i class="nightshift fa fa-moon-o" id="nightshift" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="/js/nightshift.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zindex="-1" data-click="false"></script><script id="ribbon" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/js/piao.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script>const observer = lozad(); // lazy loads elements with default selector as '.lozad'
observer.observe();
</script></body></html>